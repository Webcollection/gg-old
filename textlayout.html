<html>
<head>
<meta charset="utf-8">
<title>The Grammar of Graphics</title>
<link rel="stylesheet" type="text/css" href="./css/gg.css"/>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="./vendor/js/underscore.min.js"></script>
<script src="./js/gg.js"></script>
<script src="./js/prettify.js"></script>
</head>
<body style="width:100%">
<style>
  #spec {
    font-family: consolas, arial, monospace;
    margin-left: 2em;
    font-size: 10pt;
    width: 100%;
    height: auto;
    border: none;
    background: inherit;
  }
  #toggle {
    text-decoration: underline;
    color: steelblue;
    font-size: 12pt;
    cursor: pointer;
  }
  #toggle:hover {
    color: blue;
  }
</style>
<div style="width: 900px; float: left;">
  <div id="ex"></div>
  <button style="width: 900px; font-size: 25pt; font-family:Gill Sans;" id="btn">
    Randomize layout
  </button>
</div>
<div style="width: 20em; height: 100%; float: left; margin-left: 2em;">
  <h3>Specification <span id="toggle">toggle final layout</span></h3>
  <pre id="spec"></pre>
</div>
<div style="clear: both"></div>


<script>
  var finalRects = {
    "geom": "rect",
    "aes": { "fill-opacity": 0.8 },
    "pos": "text"
  };

  var base_spec = {
    "layers": [
      {
        "geom": "rect",
        "aes": { "fill-opacity": 0.15, }
      },
      finalRects,
      {
        "geom": "point",
        "aes": { "r": 5, "fill-opacity": 1 }
      },
      {
        "geom": "text",
        "aes": { color: "black" },
        "scales": { fill: "identity" }
      }
    ],
    aes: {
      x: "x0",
      y: "y0",
      text: "id",
      color: "id"
    },
    "scales": {
      "fill-opacity": "identity",
    },
    "options": {
      "w": 900,
      "h": 800
    }
  };


  var genboxes = function(n) {
    var pw = 250,
        ph = 200,
        lw = 30,
        lh = 15,
        genpt = function() {
          return [
            Math.floor(Math.random()*(pw-lw)),
            Math.floor(Math.random()*(ph-lh))
          ]
        };
    return _.times(n, function(i) {
      var pt = genpt();
      return {
        id: i,
        x0: pt[0],
        x1: pt[0]+lw,
        y0: pt[1],
        y1: pt[1]+lh
      };
    });
  };

  var render = function(data) {
    var ex   = function () {
      $("#ex").empty();
      return d3.select('#ex').append('span');
    };

    $("#spec").text(JSON.prettify(spec));
    var plot = gg(spec);
    plot.render(ex(), data);
  }

  var toggle = (function(){
    var show = false;
    function _toggle() {
      $("g.layer-1").toggle();
      return;
      Math.seedrandom(show+"");
      show = !show;
      spec = JSON.parse(JSON.stringify(base_spec));
      if (show)
        spec.layers = [finalRects].concat(spec.layers);
      render(data);
    };
    return _toggle;
  })();


  var data = genboxes(30);
  var spec = base_spec;

  $(document).ready(function() {
    $("#btn").click(function() {
      data = genboxes(30);
      render(data);
    });
    $("#toggle").click(toggle);
    render(data);
  });



</script>


</body>
</html>
